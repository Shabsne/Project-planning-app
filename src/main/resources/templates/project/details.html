<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${project.name}">Projekt Detaljer</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<div class="header-container">
    <a th:href="@{/employee/home/{id}(id=${session.employee.employeeId})}" class="logo-container" style="text-decoration: none;">
        <div class="logo-icon">α</div>
        <div class="logo-text">
            <span class="logo-text-main">Alpha Solutions</span>
            <span class="logo-text-sub">Project Management</span>
        </div>
    </a>
    <a href="/logout" class="logout-link">Log ud</a>
</div>

<div class="main-content">
    <div class="page-header">
        <h1 th:text="${project.name}">Projekt Navn</h1>
        <div class="header-actions">
            <a th:href="@{/projects/{id}/edit(id=${project.id})}" class="menu-button">Rediger projekt</a>
        </div>
    </div>

    <div class="project-details-container">
        <!-- Project Info Card -->
        <div class="details-card">
            <h2>Projekt Information</h2>
            <div class="details-grid">
                <div class="detail-item">
                    <span class="detail-label">Beskrivelse</span>
                    <span class="detail-value" th:text="${project.description}">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Projektleder</span>
                    <span class="detail-value" th:text="${project.projectLeader != null ? project.projectLeader.name : 'Ikke tildelt'}">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Start</span>
                    <span class="detail-value" th:text="${project.startDate != null ? #temporals.format(project.startDate, 'dd/MM/yyyy HH:mm') : '-'}">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Slut</span>
                    <span class="detail-value" th:text="${project.endDate != null ? #temporals.format(project.endDate, 'dd/MM/yyyy HH:mm') : '-'}">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Estimerede timer</span>
                    <span class="detail-value"><strong th:text="${totalEstimatedHours}">0</strong> timer</span>
                </div>
            </div>
        </div>

        <!-- Parent Project -->
        <div class="details-card" th:if="${project.parentProject != null}">
            <h2>Hovedprojekt</h2>
            <a th:href="@{/projects/{id}(id=${project.parentProject.id})}"
               class="parent-link"
               th:text="${project.parentProject.name}">Hovedprojekt</a>
        </div>

        <!-- Subprojects -->
        <div class="details-card" th:if="${project.parentProject == null}">
            <div class="card-header-flex">
                <h2>Delprojekter</h2>
                <a th:href="@{/projects/{id}/sub/create(id=${project.id})}" class="button-accent menu-button small-button">+ Opret delprojekt</a>
            </div>

            <div th:if="${project.subProjects != null and !#lists.isEmpty(project.subProjects)}">
                <div class="subproject-list">
                    <div th:each="sp : ${project.subProjects}" class="subproject-item">
                        <a th:href="@{/projects/{id}(id=${sp.id})}" th:text="${sp.name}" class="subproject-name">Delprojekt</a>
                        <span class="subproject-leader" th:text="${sp.projectLeader != null ? sp.projectLeader.name : 'Ikke tildelt'}">-</span>
                    </div>
                </div>
            </div>

            <p th:if="${project.subProjects == null || #lists.isEmpty(project.subProjects)}" class="empty-state">
                Ingen delprojekter endnu.
            </p>
        </div>

        <!-- Tasks -->
        <div class="details-card">
            <div class="card-header-flex">
                <h2>Opgaver</h2>
                <a th:href="@{/projects/{id}/createTask(id=${project.id})}" class="button-accent menu-button small-button">+ Opret opgave</a>
            </div>

            <div th:if="${rootTasks != null and !#lists.isEmpty(rootTasks)}" class="task-table">
                <div class="table-header">
                    <span>Titel</span>
                    <span>Status</span>
                    <span>Deadline</span>
                </div>
                <div th:each="task : ${rootTasks}" class="table-row">
                    <a th:href="@{/projects/{projectId}/tasks/{taskId}(projectId=${project.id}, taskId=${task.taskId})}"
                       th:text="${task.title}" class="task-title">Opgave</a>
                    <span class="task-status" th:text="${task.status}">Status</span>
                    <span th:text="${#temporals.format(task.deadline, 'dd/MM/yyyy HH:mm')}">-</span>
                </div>
            </div>
            <p th:if="${rootTasks == null || #lists.isEmpty(rootTasks)}" class="empty-state">
                Ingen opgaver endnu.
            </p>
        </div>


        <!-- Employee Management Section -->
        <div class="details-card">
            <h2>Tildel Medarbejder</h2>

            <!-- Dropdown til at tildele ny medarbejder -->
            <div th:if="${availableEmployees != null and !#lists.isEmpty(availableEmployees)}"
                 style="margin-bottom: 30px; padding: 20px; background: #f8f9fb; border-radius: 8px; border: 2px solid var(--alpha-gray-light);">

                <form th:action="@{/projects/{projectId}/assign-employee(projectId=${project.id})}"
                      method="post"
                      style="display: flex; gap: 12px; align-items: flex-end;">

                    <div class="form-group" style="flex: 1; margin: 0;">
                        <label for="employeeSelect" style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--alpha-blue-dark);">
                            Vælg medarbejder
                        </label>
                        <select id="employeeSelect"
                                name="employeeId"
                                required
                                style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid var(--alpha-gray-light); font-size: 15px;">
                            <option value="">-- Vælg en medarbejder --</option>
                            <option th:each="emp : ${availableEmployees}"
                                    th:value="${emp.employeeId}"
                                    th:text="${emp.name + ' (' + emp.email + ')'}">
                            </option>
                        </select>
                    </div>

                    <button type="submit" class="button-primary" style="margin: 0; white-space: nowrap;">
                        Tildel til projekt
                    </button>
                </form>
            </div>

            <div th:if="${availableEmployees == null || #lists.isEmpty(availableEmployees)}"
                 style="padding: 15px; background: #fff5f5; border-radius: 8px; border-left: 4px solid var(--alpha-orange); margin-bottom: 25px;">
                <p style="margin: 0; color: var(--alpha-gray); font-style: italic;">
                    Alle medarbejdere er allerede tildelt til dette projekt.
                </p>
            </div>

            <!-- Liste over tildelte medarbejdere -->
            <h3 style="margin-top: 25px; margin-bottom: 15px; font-size: 16px; color: var(--alpha-blue-dark);">
                Tildelte Medarbejdere på Projektet
            </h3>

            <div th:if="${project.assignedEmployees != null and !#lists.isEmpty(project.assignedEmployees)}"
                 class="employee-list-grid">
                <div th:each="e : ${project.assignedEmployees}"
                     class="employee-card-item">
                    <div class="employee-info">
                        <div class="employee-name-badge">
                            <span class="employee-initial" th:text="${#strings.substring(e.name, 0, 1)}">A</span>
                        </div>
                        <div class="employee-details">
                            <span class="employee-name" th:text="${e.name}">Navn</span>
                            <span class="employee-email" th:text="${e.email}">email</span>
                            <span class="employee-role" th:if="${e.role != null}" th:text="${e.role.displayName}">Rolle</span>
                        </div>
                    </div>
                    <form th:action="@{/projects/{projectId}/remove-employee/{employeeId}(projectId=${project.id}, employeeId=${e.employeeId})}"
                          method="post"
                          style="display:inline;">
                        <button type="submit"
                                class="remove-btn-inline"
                                onclick="return confirm('Er du sikker på, at du vil fjerne denne medarbejder fra projektet?');">
                            ✕ Fjern
                        </button>
                    </form>
                </div>
            </div>

            <p th:if="${project.assignedEmployees == null || #lists.isEmpty(project.assignedEmployees)}"
               class="empty-state">
                Ingen medarbejdere er tildelt til dette projekt endnu.
            </p>
        </div>

        <!-- Danger Zone -->
        <div class="details-card danger-card">
            <p>Sletning af projektet kan ikke fortrydes.</p>
            <form th:action="@{/projects/{id}/delete(id=${project.id})}"
                  method="post"
                  style="display:inline;"
                  onsubmit="return confirm('Er du sikker på, at du vil slette dette projekt? Denne handling kan ikke fortrydes.');">
                <button type="submit" class="button-danger">Slet projekt</button>
            </form>
        </div>

        <a href="/projects" class="back-link">← Tilbage til projekter</a>
    </div>
</div>
</body>
</html>