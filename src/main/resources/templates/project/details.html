<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${project.name}">Projekt Detaljer</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<div class="header-container">
    <div class="logo-container">
        <div class="logo-icon">Œ±</div>
        <div class="logo-text">
            <span class="logo-text-main">Alpha Solutions</span>
            <span class="logo-text-sub">Project Management</span>
        </div>
    </div>
    <a href="/logout" class="logout-link">Log ud</a>
</div>

<div class="main-content">
    <div class="page-header">
        <h1 th:text="${project.name}">Projekt Navn</h1>
        <div class="header-actions">
            <a th:href="@{/projects/{id}/edit(id=${project.id})}" class="menu-button">Rediger projekt</a>
        </div>
    </div>

    <div class="project-details-container">
        <!-- Project Info Card -->
        <div class="details-card">
            <h2>Projekt Information</h2>
            <div class="details-grid">
                <div class="detail-item">
                    <span class="detail-label">Beskrivelse</span>
                    <span class="detail-value" th:text="${project.description}">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Projektleder</span>
                    <span class="detail-value" th:text="${project.projectLeader != null ? project.projectLeader.name : 'Ikke tildelt'}">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Start</span>
                    <span class="detail-value" th:text="${project.startDate != null ? #temporals.format(project.startDate, 'dd/MM/yyyy HH:mm') : '-'}">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Slut</span>
                    <span class="detail-value" th:text="${project.endDate != null ? #temporals.format(project.endDate, 'dd/MM/yyyy HH:mm') : '-'}">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Estimerede timer</span>
                    <span class="detail-value"><strong th:text="${totalEstimatedHours}">0</strong> timer</span>
                </div>
            </div>
        </div>

        <!-- Parent Project -->
        <div class="details-card" th:if="${project.parentProject != null}">
            <h2>Hovedprojekt</h2>
            <a th:href="@{/projects/{id}(id=${project.parentProject.id})}"
               class="parent-link"
               th:text="${project.parentProject.name}">Hovedprojekt</a>
        </div>

        <!-- Subprojects -->
        <div class="details-card" th:if="${project.parentProject == null}">
            <div class="card-header-flex">
                <h2>Delprojekter</h2>
                <a th:href="@{/projects/{id}/sub/create(id=${project.id})}" class="button-accent menu-button small-button">+ Opret delprojekt</a>
            </div>

            <div th:if="${project.subProjects != null and !#lists.isEmpty(project.subProjects)}">
                <div class="subproject-list">
                    <div th:each="sp : ${project.subProjects}" class="subproject-item">
                        <a th:href="@{/projects/{id}(id=${sp.id})}" th:text="${sp.name}" class="subproject-name">Delprojekt</a>
                        <span class="subproject-leader" th:text="${sp.projectLeader != null ? sp.projectLeader.name : 'Ikke tildelt'}">-</span>
                    </div>
                </div>
            </div>

            <p th:if="${project.subProjects == null || #lists.isEmpty(project.subProjects)}" class="empty-state">
                Ingen delprojekter endnu.
            </p>
        </div>

        <!-- Tasks -->
        <div class="details-card">
            <div class="card-header-flex">
                <h2>Opgaver</h2>
                <a th:href="@{/projects/{id}/createTask(id=${project.id})}" class="button-accent menu-button small-button">+ Opret task</a>
            </div>

            <div th:if="${rootTasks != null and !#lists.isEmpty(rootTasks)}" class="task-table">
                <div class="table-header">
                    <span>Titel</span>
                    <span>Status</span>
                    <span>Deadline</span>
                </div>
                <div th:each="task : ${rootTasks}" class="table-row">
                    <a th:href="@{/projects/{projectId}/tasks/{taskId}(projectId=${project.id}, taskId=${task.taskId})}"
                       th:text="${task.title}" class="task-title">Opgave</a>
                    <span class="task-status" th:text="${task.status}">Status</span>
                    <span th:text="${#temporals.format(task.deadline, 'dd/MM/yyyy HH:mm')}">-</span>
                </div>
            </div>
            <p th:if="${rootTasks == null || #lists.isEmpty(rootTasks)}" class="empty-state">
                Ingen opgaver endnu.
            </p>
        </div>


        <!-- Employee Management Section -->
        <div class="details-card">
            <h2>Tildel Medarbejder</h2>

            <!-- Dropdown til at tildele ny medarbejder -->
            <div th:if="${availableEmployees != null and !#lists.isEmpty(availableEmployees)}"
                 style="margin-bottom: 30px; padding: 20px; background: #f8f9fb; border-radius: 8px; border: 2px solid var(--alpha-gray-light);">

                <form th:action="@{/projects/{projectId}/assign-employee(projectId=${project.id})}"
                      method="post"
                      style="display: flex; gap: 12px; align-items: flex-end;">

                    <div class="form-group" style="flex: 1; margin: 0;">
                        <label for="employeeSelect" style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--alpha-blue-dark);">
                            V√¶lg medarbejder
                        </label>
                        <select id="employeeSelect"
                                name="employeeId"
                                required
                                style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid var(--alpha-gray-light); font-size: 15px;">
                            <option value="">-- V√¶lg en medarbejder --</option>
                            <option th:each="emp : ${availableEmployees}"
                                    th:value="${emp.employeeId}"
                                    th:text="${emp.name + ' (' + emp.email + ')'}">
                            </option>
                        </select>
                    </div>

                    <button type="submit" class="button-primary" style="margin: 0; white-space: nowrap;">
                        ‚ûï Tildel til projekt
                    </button>
                </form>
            </div>

            <div th:if="${availableEmployees == null || #lists.isEmpty(availableEmployees)}"
                 style="padding: 15px; background: #fff5f5; border-radius: 8px; border-left: 4px solid var(--alpha-orange); margin-bottom: 25px;">
                <p style="margin: 0; color: var(--alpha-gray); font-style: italic;">
                    ‚ÑπÔ∏è Alle medarbejdere er allerede tildelt til dette projekt.
                </p>
            </div>

            <!-- Liste over tildelte medarbejdere -->
            <h3 style="margin-top: 25px; margin-bottom: 15px; font-size: 16px; color: var(--alpha-blue-dark);">
                Tildelte Medarbejdere p√• Projektet
            </h3>

            <div th:if="${project.assignedEmployees != null and !#lists.isEmpty(project.assignedEmployees)}"
                 class="employee-list-grid">
                <div th:each="e : ${project.assignedEmployees}"
                     class="employee-card-item">
                    <div class="employee-info">
                        <div class="employee-name-badge">
                            <span class="employee-initial" th:text="${#strings.substring(e.name, 0, 1)}">A</span>
                        </div>
                        <div class="employee-details">
                            <span class="employee-name" th:text="${e.name}">Navn</span>
                            <span class="employee-email" th:text="${e.email}">email</span>
                            <span class="employee-role" th:if="${e.role != null}" th:text="${e.role.displayName}">Rolle</span>
                        </div>
                    </div>
                    <form th:action="@{/projects/{projectId}/remove-employee/{employeeId}(projectId=${project.id}, employeeId=${e.employeeId})}"
                          method="post"
                          style="display:inline;">
                        <button type="submit"
                                class="remove-btn-inline"
                                onclick="return confirm('Er du sikker p√•, at du vil fjerne denne medarbejder fra projektet?');">
                            ‚úï Fjern
                        </button>
                    </form>
                </div>
            </div>

            <p th:if="${project.assignedEmployees == null || #lists.isEmpty(project.assignedEmployees)}"
               class="empty-state">
                Ingen medarbejdere er tildelt til dette projekt endnu.
            </p>
        </div>

        <!-- Danger Zone -->
        <div class="details-card danger-card">
            <p>Sletning af projektet kan ikke fortrydes.</p>
            <form th:action="@{/projects/{id}/delete(id=${project.id})}"
                  method="post"
                  style="display:inline;"
                  onsubmit="return confirm('Er du sikker p√•, at du vil slette dette projekt? Denne handling kan ikke fortrydes.');">
                <button type="submit" class="button-danger">üóëÔ∏è Slet projekt</button>
            </form>
        </div>

        <a href="/projects" class="back-link">‚Üê Tilbage til projekter</a>
    </div>
</div>

<style>
    /* Styling til medarbejder cards */
    .employee-list-grid {
        display: grid;
        gap: 12px;
    }

    .employee-card-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        background: white;
        border-radius: 8px;
        border: 2px solid var(--alpha-gray-light);
        transition: all 0.2s;
    }

    .employee-card-item:hover {
        border-color: var(--alpha-blue);
        box-shadow: 0 2px 8px rgba(0, 93, 130, 0.1);
    }

    .employee-info {
        display: flex;
        align-items: center;
        gap: 14px;
        flex: 1;
    }

    .employee-name-badge {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--alpha-blue) 0%, var(--alpha-blue-light) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .employee-initial {
        color: white;
        font-size: 20px;
        font-weight: 700;
        text-transform: uppercase;
    }

    .employee-details {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .employee-details .employee-name {
        font-weight: 600;
        color: var(--alpha-blue-dark);
        font-size: 15px;
    }

    .employee-details .employee-email {
        color: var(--alpha-gray);
        font-size: 13px;
    }

    .employee-details .employee-role {
        color: var(--alpha-blue);
        font-size: 12px;
        font-weight: 600;
    }

    .remove-btn-inline {
        padding: 8px 18px;
        background: white;
        color: var(--alpha-orange);
        border: 2px solid var(--alpha-orange);
        border-radius: 6px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
    }

    .remove-btn-inline:hover {
        background: var(--alpha-orange);
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .employee-card-item {
            flex-direction: column;
            align-items: stretch;
            gap: 12px;
        }

        .remove-btn-inline {
            width: 100%;
        }
    }
</style>

</body>
</html>