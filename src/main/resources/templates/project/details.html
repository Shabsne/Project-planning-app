<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${project.name}">Project Details</title>
</head>
<body>

<h1 th:text="${project.name}">Project Name</h1>
<p><strong>Description:</strong> <span th:text="${project.description}"></span></p>
<p><strong>Start:</strong> <span th:text="${project.startDate}"></span></p>
<p><strong>End:</strong> <span th:text="${project.endDate}"></span></p>

<hr>

<!-- Edit / Delete -->
<a th:href="@{'/projects/' + ${project.id} + '/edit'}">Edit Project</a>

<form th:action="@{'/projects/' + ${project.id} + '/delete'}" method="post" style="display:inline;">
    <button type="submit">Delete Project</button>
</form>

<hr>

<!-- Parent Project -->
<h2>Parent Project</h2>
<div th:if="${project.parentProject != null}">
    <a th:href="@{'/projects/' + ${project.parentProject.id}}"
       th:text="${project.parentProject.name}"></a>
</div>
<div th:if="${project.parentProject == null}">
    <p>No parent (this is a root project)</p>
</div>

<hr>

<!-- Subprojects -->
<h2>Subprojects</h2>
<a th:href="@{'/projects/' + ${project.id} + '/sub/create'}">Create Subproject</a>

<table>
    <tr><th>Name</th></tr>
    <tr th:each="sp : ${project.subProjects}">
        <td>
            <a th:href="@{'/projects/' + ${sp.id}}"
               th:text="${sp.name}"></a>
        </td>
    </tr>
</table>

<hr>

<!-- Tasks -->
<h2>Tasks</h2>
<table>
    <tr>
        <th>Title</th>
        <th>Status</th>
        <th>Deadline</th>
    </tr>
    <!-- Kun root tasks -->
    <tr th:each="t : ${project.tasks}" th:if="${t.parentTask == null}">
        <td>
            <a th:href="@{/projects/{projectId}/tasks/{taskId}(projectId=${project.id}, taskId=${t.taskId})}"
               th:text="${t.title}"></a>
        </td>
        <td>
            <form th:action="@{/projects/{projectId}/tasks/{taskId}/updateFromProjectView(projectId=${project.id}, taskId=${t.taskId})}"
                  method="post">
                <select name="status" onchange="this.form.submit()">
                    <option th:each="s : ${status}"
                            th:value="${s}"
                            th:text="${s}"
                            th:selected="${s == t.status}">
                    </option>
                </select>
            </form>
        </td>
        <td th:text="${#temporals.format(t.deadline, 'dd-MM-yyyy HH:mm')}"></td>
    </tr>
    <tr>
        <td colspan="3">
            <a th:href="@{/projects/{projectId}/tasks/create(projectId=${project.id})}">+ Create New Task</a>
        </td>
    </tr>
</table>




<hr>

<!-- Employees -->
<h2>Assigned Employees</h2>
<table>
    <tr><th>Name</th><th>Email</th></tr>
    <tr th:each="e : ${project.assignedEmployees}">
        <td th:text="${e.name}"></td>
        <td th:text="${e.email}"></td>
    </tr>
</table>

<br>
<a href="/projects">â¬… Back to list</a>

</body>
</html>
